<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profile Page</title>
    <link rel="stylesheet" href="CSS/styles6.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body>
    <!-- <h1>Welcome to the Profile page</h1>
    <h2 id="name">Your Full Name is:</h2>
    <img id="image">
    <button onclick="logout()">Logout</button> -->
    <div class="container light-style flex-grow-1 container-p-y">
        <div class="card">
            <div class="row no-gutters row-bordered row-border-light">
                <div class="col-md-3 pt-0">
                    <div class="list-group list-group-flush account-settings-links">
                        <div id="profile-image"><img src="https://bootdey.com/img/Content/avatar/avatar1.png" alt
                                class="d-block ui-w-80" id="image"></div>
                        <a class="list-group-item list-group-item-action active" data-toggle="list"
                            href="#account-general">General</a>
                        <!-- <a class="list-group-item list-group-item-action" data-toggle="list"
                            href="#account-change-password">Change password</a> -->
                        <a class="list-group-item list-group-item-action" data-toggle="list"
                            href="#account-info">Info</a>
                        <a class="list-group-item list-group-item-action" data-toggle="list"
                            href="#account-social-links">Social links</a>
                        <!-- <a class="list-group-item list-group-item-action" data-toggle="list"
                            href="#account-connections">Connections</a> -->
                        <a class="list-group-item list-group-item-action" data-toggle="list"
                            href="#account-notifications">Notifications</a>
                        <a class="list-group-item list-group-item-action" href="/">Back to home</a>
                        <a class="list-group-item list-group-item-action" onclick="logout()">Signout</a>
                    </div>
                </div>
                <div class="col-md-9">
                    <div class="tab-content">
                        <div class="tab-pane fade active show" id="account-general">
                            <div class="card-body media align-items-center">
                                <!-- <img src="https://bootdey.com/img/Content/avatar/avatar1.png" alt
                                    class="d-block ui-w-80" id="image"> -->
                                <div class="media-body ml-4">
                                    <!-- <label class="btn btn-outline-primary">
                                        Upload new photo
                                        <input type="file" class="account-settings-fileinput">
                                    </label> &nbsp; -->
                                    <!-- <button type="button" class="btn btn-default md-btn-flat">Reset</button> -->
                                    <!-- <a href="/"><button class="button-59" role="button" id="BTH">Back to
                                            home</button></a> -->
                                    <!-- <div class="text-light small mt-1">Allowed JPG, GIF or PNG. Max size of 800K</div> -->
                                </div>
                            </div>
                            <hr class="border-light m-0">
                            <div class="card-body">
                                <div class="form-group">
                                    <label class="form-label">Username</label>
                                    <input type="text" class="form-control mb-1" value="nmaxwell" id="username">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Name</label>
                                    <input type="text" class="form-control" value="Nelle Maxwell" id="name">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">E-mail</label>
                                    <input type="text" class="form-control mb-1" value="nmaxwell@mail.com" id="email">
                                    <div class="alert alert-warning mt-3">
                                        Your email is not confirmed. Please check your inbox.<br>
                                        <a href="javascript:void(0)">Resend confirmation</a>
                                    </div>
                                </div>
                                <!-- <div class="form-group">
                                    <label class="form-label">Company</label>
                                    <input type="text" class="form-control" value="Company Ltd.">
                                </div> -->
                            </div>
                        </div>
                        <!-- <div class="tab-pane fade" id="account-change-password">
                            <div class="card-body pb-2">
                                <div class="form-group">
                                    <label class="form-label">Current password</label>
                                    <input type="password" class="form-control">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">New password</label>
                                    <input type="password" class="form-control">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Repeat new password</label>
                                    <input type="password" class="form-control">
                                </div>
                            </div>
                        </div> -->
                        <div class="tab-pane fade" id="account-info">
                            <div class="card-body pb-2">
                                <div class="form-group">
                                    <label class="form-label">Bio</label>
                                    <textarea class="form-control"
                                        rows="5">Lorem ipsum dolor sit amet, consectetur adipiscing elit. Mauris nunc arcu, dignissim sit amet sollicitudin iaculis, vehicula id urna. Sed luctus urna nunc. Donec fermentum, magna sit amet rutrum pretium, turpis dolor molestie diam, ut lacinia diam risus eleifend sapien. Curabitur ac nibh nulla. Maecenas nec augue placerat, viverra tellus non, pulvinar risus.</textarea>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Birthday</label>
                                    <input type="text" class="form-control" value="May 3, 1995">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Country</label>
                                    <select class="custom-select">
                                        <option>USA</option>
                                        <option selected>Canada</option>
                                        <option>UK</option>
                                        <option>Germany</option>
                                        <option>France</option>
                                    </select>
                                </div>
                            </div>
                            <hr class="border-light m-0">
                            <div class="card-body pb-2">
                                <h6 class="mb-4">Contacts</h6>
                                <div class="form-group">
                                    <label class="form-label">Phone</label>
                                    <input type="text" class="form-control" value="+0 (123) 456 7891">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Website</label>
                                    <input type="text" class="form-control" value>
                                </div>
                            </div>
                        </div>
                        <div class="tab-pane fade" id="account-social-links">
                            <div class="card-body pb-2">
                                <div class="form-group">
                                    <label class="form-label">Twitter</label>
                                    <input type="text" class="form-control" value="https://twitter.com/user">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Facebook</label>
                                    <input type="text" class="form-control" value="https://www.facebook.com/user">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Google+</label>
                                    <input type="text" class="form-control" value>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">LinkedIn</label>
                                    <input type="text" class="form-control" value>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Instagram</label>
                                    <input type="text" class="form-control" value="https://www.instagram.com/user">
                                </div>
                            </div>
                        </div>
                        <!-- <div class="tab-pane fade" id="account-connections">
                            <div class="card-body">
                                <button type="button" class="btn btn-twitter">Connect to
                                    <strong>Twitter</strong></button>
                            </div>
                            <hr class="border-light m-0">
                            <div class="card-body">
                                <h5 class="mb-2">
                                    <a href="javascript:void(0)" class="float-right text-muted text-tiny"><i
                                            class="ion ion-md-close"></i> Remove</a>
                                    <i class="ion ion-logo-google text-google"></i>
                                    You are connected to Google:
                                </h5>
                                <a href="/cdn-cgi/l/email-protection" class="__cf_email__"
                                    data-cfemail="f9979498818e9c9595b994989095d79a9694">[email&#160;protected]</a>
                            </div>
                            <hr class="border-light m-0">
                            <div class="card-body">
                                <button type="button" class="btn btn-facebook">Connect to
                                    <strong>Facebook</strong></button>
                            </div>
                            <hr class="border-light m-0">
                            <div class="card-body">
                                <button type="button" class="btn btn-instagram">Connect to
                                    <strong>Instagram</strong></button>
                            </div>
                        </div> -->
                        <div class="tab-pane fade" id="account-notifications">
                            <div class="card-body pb-2">
                                <h6 class="mb-4">Activity</h6>
                                <div class="form-group">
                                    <label class="switcher">
                                        <input type="checkbox" class="switcher-input" checked>
                                        <span class="switcher-indicator">
                                            <span class="switcher-yes"></span>
                                            <span class="switcher-no"></span>
                                        </span>
                                        <span class="switcher-label">Email me when someone comments on my article</span>
                                    </label>
                                </div>
                                <div class="form-group">
                                    <label class="switcher">
                                        <input type="checkbox" class="switcher-input" checked>
                                        <span class="switcher-indicator">
                                            <span class="switcher-yes"></span>
                                            <span class="switcher-no"></span>
                                        </span>
                                        <span class="switcher-label">Email me when someone answers on my forum
                                            thread</span>
                                    </label>
                                </div>
                                <div class="form-group">
                                    <label class="switcher">
                                        <input type="checkbox" class="switcher-input">
                                        <span class="switcher-indicator">
                                            <span class="switcher-yes"></span>
                                            <span class="switcher-no"></span>
                                        </span>
                                        <span class="switcher-label">Email me when someone follows me</span>
                                    </label>
                                </div>
                            </div>
                            <hr class="border-light m-0">
                            <div class="card-body pb-2">
                                <h6 class="mb-4">Application</h6>
                                <div class="form-group">
                                    <label class="switcher">
                                        <input type="checkbox" class="switcher-input" checked>
                                        <span class="switcher-indicator">
                                            <span class="switcher-yes"></span>
                                            <span class="switcher-no"></span>
                                        </span>
                                        <span class="switcher-label">News and announcements</span>
                                    </label>
                                </div>
                                <div class="form-group">
                                    <label class="switcher">
                                        <input type="checkbox" class="switcher-input">
                                        <span class="switcher-indicator">
                                            <span class="switcher-yes"></span>
                                            <span class="switcher-no"></span>
                                        </span>
                                        <span class="switcher-label">Weekly product updates</span>
                                    </label>
                                </div>
                                <div class="form-group">
                                    <label class="switcher">
                                        <input type="checkbox" class="switcher-input" checked>
                                        <span class="switcher-indicator">
                                            <span class="switcher-yes"></span>
                                            <span class="switcher-no"></span>
                                        </span>
                                        <span class="switcher-label">Weekly blog digest</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="text-right mt-3">
            <button type="button" class="btn btn-primary">Save changes</button>&nbsp;
            <button class="button-24" role="button">Reset</button>
        </div>
    </div>
    <script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script>
    <script src="https://code.jquery.com/jquery-1.10.2.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/js/bootstrap.bundle.min.js"></script>
    <script type="text/javascript">
    </script>
</body>
<script>
    //So here first of all we need to capture this information i.e:the access token from the browser URL.
    let params = {//Here "params" is an empty object.

    }
    //So here basically we would be getting the access token from the URL parameters by using some kind of Regular Expression i.e:Regex.
    let regex = /([^&=]*)=([^&=]*)/g, m;//This regular expression /([^&=])=([^&=]*)/g is used to extract key-value pairs from a URL query string.
    //Now we will simply run a while() loop.
    while (m = regex.exec(location.href))//Here "m" is basically an index variable.Also here the "regex" has an "exec() i.e:execute method".Here basically we are going to access the "location.href",this basically corresponds to the URL itself.while (m = regex.exec(location.href)) { ... }: This is a while loop that executes as long as the regex.exec() method finds matches in the URL. Each iteration of the loop captures a key-value pair and advances to the next match until no more matches are found."regex.exec(location.href)": This method applies the regular expression pattern (regex) to the URL (location.href) and returns an array (m) containing information about the first match found. If no match is found, it returns null.
    {
        params[decodeURIComponent(m[1])] = decodeURIComponent(m[2]);//Inside the loop, this line extracts the key-value pair from the match m and stores it in the params object.
    }
    //Now we will capture the access token inside the local storage.
    if (Object.keys(params).length > 0) {
        localStorage.setItem('authInfo', JSON.stringify(params));//So here all the information i.e: the key-value pairs that we parsed from the browser URL,would be stored inside a local storage variable i.e:authInfo.
    }
    //Now we need to hide this information i.e: the access token from the browser URl for security purposes.
    window.history.pushState({}, document.title, "/" + "Profile");//The window.history.pushState() method is used to modify the browser's history state and URL without causing a full page reload.
    let info = JSON.parse(localStorage.getItem('authInfo'));
    console.log(JSON.parse(localStorage.getItem('authInfo')));//So here we can see the Object returned in the console.
    console.log(info['access_token']);//Here we can see the access token through which we can access any Google API,Youtube API,Drive API,Google SpreadSheet API,etc.
    console.log(info['expires_in']);//Here it gives us a numerical value in seconds.

    //Now we are going to make a simple GET request using fetch API.As soon as the page loads we will make this fetch request.
    fetch("https://www.googleapis.com/oauth2/v3/userinfo", {//So basically this is the URL which will get access to the profile picture and the email address.Also inside this fetch we need to provide "headers" as well.So here the header which we are going to provide is simply the "authorization header".
        headers: {
            "Authorization": `Bearer ${info['access_token']}`
        }
    })
        //Now here the above part of code is going to return a promise which we can handle using ".then()".And basically this will contain our "data" which we need to convert into "JSON".
        .then((data) => data.json())
        //Also this would be returning the "info i.e: the information".
        .then((info) => { //Now inside this "info" object we will see that we have "full name" and "profile picture"
            console.log(info);
            //Now we are going to target the elements with the id "name" and "image".
            document.getElementById("name").value = info.family_name;//Here we are basically manipulating the innerHTML. 
            document.getElementById("username").value = info.name;
            document.getElementById("image").setAttribute('src', info.picture);//Here we are basically setting up the "src" attribute for the "image" element as "info.picture".
            document.getElementById("email").value = info.email;
        })
    //Now we want that when we click the Logout button,then the access token should get removed/revoked so that the user can't use it.So for that we are going to write a "Logout()".
    function logout() {
        //Here again we need to make a fetch request but this time it will be a "POST" request.
        fetch("https://oauth2.googleapis.com/revoke?token=" + info['access_token'], {//Here we are basically concatenating the access token with the URL.So we just need to remove this "access_token" from our account.
            method: "POST",
            headers: {
                'Content-type': 'application/x-www-form-urlencoded'
            }
        })
            //Now here the above part of code is going to return a promise which we are going to handle using ".then()".
            .then((data) => {//And basically this will contain our "data".So we can basically redirect the user to the "home page".
                location.href = "http://127.0.0.1:3000/"
            })
        localStorage.removeItem('authInfo');

    }
</script>


</html>